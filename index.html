<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <title>Asteroides Pr칩ximos da Terra</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
      background-color: #f9f9f9;
    }

    h1 {
      margin-bottom: 10px;
    }

    input, button {
      padding: 8px;
      margin: 10px;
      font-size: 16px;
    }

    #status {
      margin-top: 10px;
      font-size: 18px;
      color: #333;
    }

    #erro {
      color: red;
      font-weight: bold;
      margin-top: 10px;
    }

    table {
      width: 95%;
      margin: 20px auto;
      border-collapse: collapse;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: center;
    }

    th {
      background-color: #eee;
    }

    tr.perigoso {
      background-color: #ffe5e5;
      font-weight: bold;
    }

    tr:hover {
      background-color: #f1f1f1;
    }

    #orbita {
      width: 100%;
      max-width: 800px;
      height: 500px;
      margin: 30px auto;
      border: 1px solid #ccc;
      display: flex;
      justify-content: center;
      align-items: center;
    }
  </style>
</head>
<body>
  <h1>游깴 Asteroides Pr칩ximos da Terra</h1>

  <label for="date">Escolhe uma data:</label>
  <input type="date" id="date" value="2025-09-07" />
  <button onclick="buscarAsteroides()">游댌 Ver Asteroides</button>

  <div id="status"></div>
  <div id="erro"></div>

  <table id="neo-table">
    <thead>
      <tr>
        <th>Nome</th>
        <th>Magnitude</th>
        <th>Di칙metro M칤n (km)</th>
        <th>Di칙metro M치x (km)</th>
        <th>Perigoso?</th>
        <th>Data Aproxima칞칚o</th>
        <th>Velocidade (km/h)</th>
        <th>Dist칙ncia (km)</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div id="orbita"></div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>

  <script>
    let cena, camera, renderer;

    function inicializarOrbita() {
      cena = new THREE.Scene();
      camera = new THREE.PerspectiveCamera(75, 800 / 500, 0.1, 1000);
      renderer = new THREE.WebGLRenderer();
      renderer.setSize(800, 500);
      document.getElementById('orbita').appendChild(renderer.domElement);

      const sol = new THREE.Mesh(
        new THREE.SphereGeometry(1, 32, 32),
        new THREE.MeshBasicMaterial({ color: 0xffff00 })
      );
      cena.add(sol);

      camera.position.z = 50;
      animate();
    }

    function desenharAsteroide(distanciaAU, cor = 0x00ff00, separador = 0) {
      const raio = Math.max(distanciaAU * 10 + separador, 5);

      const orbita = new THREE.Mesh(
        new THREE.TorusGeometry(raio, 0.02, 16, 100),
        new THREE.MeshBasicMaterial({ color: cor })
      );
      orbita.rotation.x = Math.PI / 2;
      cena.add(orbita);

      const asteroide = new THREE.Mesh(
        new THREE.SphereGeometry(0.1, 16, 16),
        new THREE.MeshBasicMaterial({ color: cor })
      );
      asteroide.position.set(raio, 0, 0);
      cena.add(asteroide);
    }

    function limparOrbita() {
      while (cena.children.length > 1) {
        cena.remove(cena.children[1]);
      }
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(cena, camera);
    }

    inicializarOrbita();

    function buscarAsteroides() {
      const dataSelecionada = document.getElementById('date').value;
      const url = `https://api.nasa.gov/neo/rest/v1/feed?start_date=${dataSelecionada}&end_date=${dataSelecionada}&api_key=QGdjDosaNi342L5tT7qpE1QdWeMcbdb5LeHdHXSk`;

      document.getElementById('status').textContent = 'A carregar dados...';
      document.getElementById('erro').textContent = '';

      fetch(url)
        .then(response => response.json())
        .then(resposta => {
          const neos = resposta.near_earth_objects[dataSelecionada];
          const tbody = document.querySelector('#neo-table tbody');
          tbody.innerHTML = '';
          limparOrbita();

          let desenhados = 0;
          let maiorDistanciaAU = 0;

          neos.forEach((neo, index) => {
            const approach = neo.close_approach_data[0];
            const perigoso = neo.is_potentially_hazardous_asteroid;

            let distanciaAU = parseFloat(approach?.miss_distance?.au);
            if (isNaN(distanciaAU)) {
              const distanciaKm = parseFloat(approach?.miss_distance?.kilometers);
              if (!isNaN(distanciaKm)) {
                distanciaAU = distanciaKm / 149597870.7;
              }
            }

            if (!isNaN(distanciaAU)) {
              desenharAsteroide(distanciaAU, perigoso ? 0xff0000 : 0x00ff00, index * 2);
              desenhados++;
              if (distanciaAU > maiorDistanciaAU) maiorDistanciaAU = distanciaAU;
            }

            const row = document.createElement('tr');
            if (perigoso) row.classList.add('perigoso');

            row.innerHTML = `
              <td>${neo.name}</td>
              <td>${neo.absolute_magnitude_h}</td>
              <td>${neo.estimated_diameter.kilometers.estimated_diameter_min.toFixed(3)}</td>
              <td>${neo.estimated_diameter.kilometers.estimated_diameter_max.toFixed(3)}</td>
              <td>${perigoso ? '丘멆잺 Sim' : 'N칚o'}</td>
              <td>${approach.close_approach_date}</td>
              <td>${parseFloat(approach.relative_velocity.kilometers_per_hour).toFixed(2)}</td>
              <td>${parseFloat(approach.miss_distance.kilometers).toFixed(0)}</td>
            `;
            tbody.appendChild(row);
          });

          camera.position.z = Math.max(maiorDistanciaAU * 12 + 10, 50);

          document.getElementById('status').textContent = `Foram encontrados ${neos.length} asteroides.`;
          if (desenhados === 0) {
            document.getElementById('erro').textContent = '丘멆잺 Nenhum asteroide foi desenhado no mapa.';
          }
        })
        .catch(error => {
          document.getElementById('status').textContent = '';
          document.getElementById('erro').textContent = 'Erro ao obter dados. Verifica a data ou tenta mais tarde.';
        });
    }

    buscarAsteroides();
  </script>
</body>
</html>